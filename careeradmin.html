<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Pages Admin - buildfree.io</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --color-primary: #1a1a1a;
            --color-primary-dark: #000000;
            --color-secondary: #f8f9fa;
            --color-accent: #e9ecef;
            --color-body: #ffffff;
            --color-white: #ffffff;
            --color-text: #1a1a1a;
            --color-text-light: #6c757d;
            --color-border: #dee2e6;
            --color-success: #198754;
            --color-warning: #f59e0b;
            --color-danger: #dc3545;
            --color-info: #0dcaf0;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background-color: #f8f9fa;
            color: var(--color-text);
            padding-bottom: 2rem;
        }
        
        .navbar-brand {
            font-weight: 600;
            letter-spacing: -0.025em;
        }
        
        .auth-container {
            max-width: 400px;
            margin: 80px auto;
            padding: 2rem;
            background-color: #fff;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .admin-container {
            max-width: 1200px;
            margin: 2rem auto;
            display: none;
        }
        
        .upload-container {
            background-color: #fff;
            border-radius: 0.5rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .table-container {
            background-color: #fff;
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            overflow-x: auto;
        }
        
        .drop-area {
            border: 2px dashed var(--color-border);
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            margin-bottom: 1rem;
            transition: border-color 0.2s;
        }
        
        .drop-area:hover {
            border-color: var(--color-primary);
        }
        
        .drop-area.dragover {
            border-color: var(--color-primary);
            background-color: rgba(26, 26, 26, 0.05);
        }
        
        .file-input {
            display: none;
        }
        
        .company-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .company-table th {
            text-align: left;
            padding: 0.75rem;
            background-color: var(--color-secondary);
            border-bottom: 2px solid var(--color-border);
            font-weight: 600;
        }
        
        .company-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--color-border);
            vertical-align: middle;
        }
        
        .badge {
            font-size: 0.75rem;
            font-weight: 500;
            padding: 0.25rem 0.5rem;
        }
        
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .btn-icon {
            width: 32px;
            height: 32px;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }
        
        .preview-image {
            max-width: 100%;
            max-height: 200px;
            margin-top: 1rem;
            border-radius: 0.375rem;
            display: none;
        }
        
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1050;
            padding: 1rem;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            display: none;
        }
        
        .notification-success {
            background-color: var(--color-success);
            color: white;
        }
        
        .notification-error {
            background-color: var(--color-danger);
            color: white;
        }
        
        /* Loading spinner */
        .loader {
            display: inline-block;
            width: 1.5rem;
            height: 1.5rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 0.5rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* CSV Template Table */
        .template-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.875rem;
        }
        
        .template-table th, .template-table td {
            padding: 0.5rem;
            border: 1px solid var(--color-border);
        }
        
        .template-table th {
            background-color: var(--color-secondary);
            font-weight: 600;
        }
        
        .template-table caption {
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-align: left;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">Career Pages Admin</a>
            <button id="logout-btn" class="btn btn-outline-light btn-sm ms-auto" style="display: none;">Logout</button>
        </div>
    </nav>

    <!-- Auth Container -->
    <div class="auth-container" id="auth-container">
        <h2 class="mb-4">Admin Access</h2>
        <div class="mb-3">
            <label for="password" class="form-label">Enter Admin Password</label>
            <input type="password" class="form-control" id="password">
        </div>
        <div id="auth-error" class="alert alert-danger" style="display: none;"></div>
        <button id="login-btn" class="btn btn-primary w-100">Login</button>
    </div>

    <!-- Admin Container -->
    <div class="admin-container" id="admin-container">
        <div class="upload-container">
            <h3 class="mb-3">Upload Company Data</h3>
            <p class="text-muted mb-4">Upload an Excel file (.xlsx or .xls) with company data to bulk import into the database.</p>
            
            <div class="drop-area" id="drop-area">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-file-earmark-excel mb-3 text-muted" viewBox="0 0 16 16">
                    <path d="M5.884 6.68a.5.5 0 1 0-.768.64L7.349 10l-2.233 2.68a.5.5 0 0 0 .768.64L8 10.781l2.116 2.54a.5.5 0 0 0 .768-.641L8.651 10l2.233-2.68a.5.5 0 0 0-.768-.64L8 9.219l-2.116-2.54z"/>
                    <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
                </svg>
                <h5>Drag & Drop Excel File Here</h5>
                <p class="text-muted">or</p>
                <button class="btn btn-outline-primary" id="browse-btn">Browse Files</button>
                <input type="file" id="file-input" class="file-input" accept=".xlsx, .xls">
            </div>
            
            <div class="alert alert-info mt-3">
                <h5>Excel File Format Requirements</h5>
                <p class="mb-2">Your Excel file should have the following columns:</p>
                <table class="template-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Career Page URL</th>
                            <th>Description</th>
                            <th>Industry</th>
                            <th>Location</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>TechCorp Inc.</td>
                            <td>https://techcorp.example.com/careers</td>
                            <td>Leading software development company specializing in cloud solutions.</td>
                            <td>Technology</td>
                            <td>United States</td>
                        </tr>
                    </tbody>
                </table>
                <a href="#" class="btn btn-sm btn-outline-secondary mt-3" id="download-template">Download Template</a>
            </div>
            
            <div id="file-preview" class="mt-4" style="display: none;">
                <div class="alert alert-success">
                    <div class="d-flex align-items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-file-earmark-excel me-3" viewBox="0 0 16 16">
                            <path d="M5.884 6.68a.5.5 0 1 0-.768.64L7.349 10l-2.233 2.68a.5.5 0 0 0 .768.64L8 10.781l2.116 2.54a.5.5 0 0 0 .768-.641L8.651 10l2.233-2.68a.5.5 0 0 0-.768-.64L8 9.219l-2.116-2.54z"/>
                            <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
                        </svg>
                        <div>
                            <h5 class="mb-1" id="file-name">filename.xlsx</h5>
                            <div id="file-info">0 companies found</div>
                        </div>
                    </div>
                </div>
                
                <div class="d-flex justify-content-end mt-3">
                    <button class="btn btn-outline-secondary me-2" id="cancel-upload">Cancel</button>
                    <button class="btn btn-primary" id="import-btn">
                        <span id="import-text">Import Companies</span>
                        <span id="import-loading" style="display: none;">
                            <span class="loader"></span>Importing...
                        </span>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="table-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="mb-0">Company Database</h3>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#companyModal" id="add-company-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                    </svg>
                    Add Company
                </button>
            </div>
            
            <div class="mb-3">
                <input type="text" class="form-control" id="search-input" placeholder="Search companies...">
            </div>
            
            <div id="table-loading" class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2 text-muted">Loading companies...</p>
            </div>
            
            <div id="table-container" style="display: none;">
                <table class="company-table" id="company-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Industry</th>
                            <th>Location</th>
                            <th>Career Page</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="company-tbody">
                        <!-- Company rows will be inserted here -->
                    </tbody>
                </table>
                
                <div id="pagination" class="d-flex justify-content-between align-items-center mt-3">
                    <div id="pagination-info">Showing 0 companies</div>
                    <div>
                        <button class="btn btn-sm btn-outline-secondary" id="load-more-btn" disabled>Load More</button>
                    </div>
                </div>
            </div>
            
            <div id="no-data" class="text-center py-5" style="display: none;">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-building mb-3 text-muted" viewBox="0 0 16 16">
                    <path d="M4 2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1Zm3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1Zm3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1ZM4 5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1ZM7.5 5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1Zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1ZM4.5 8a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1Zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1Zm3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1Z"/>
                    <path d="M2 1a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V1Zm11 0H3v14h3v-2.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5V15h3V1Z"/>
                </svg>
                <h5>No companies found</h5>
                <p class="text-muted">Add a company or import data to get started</p>
            </div>
        </div>
    </div>
    
    <!-- Company Modal -->
    <div class="modal fade" id="companyModal" tabindex="-1" aria-labelledby="companyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="companyModalLabel">Add Company</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="company-form">
                        <input type="hidden" id="company-id">
                        <div class="mb-3">
                            <label for="company-name" class="form-label">Company Name *</label>
                            <input type="text" class="form-control" id="company-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="company-url" class="form-label">Career Page URL *</label>
                            <input type="url" class="form-control" id="company-url" required>
                        </div>
                        <div class="mb-3">
                            <label for="company-description" class="form-label">Description *</label>
                            <textarea class="form-control" id="company-description" rows="3" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="company-industry" class="form-label">Industry *</label>
                                <select class="form-select" id="company-industry" required>
                                    <option value="">Select Industry</option>
                                    <option value="Technology">Technology</option>
                                    <option value="Finance">Finance</option>
                                    <option value="Healthcare">Healthcare</option>
                                    <option value="Education">Education</option>
                                    <option value="Retail">Retail</option>
                                    <option value="Manufacturing">Manufacturing</option>
                                    <option value="Media">Media</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="company-location" class="form-label">Location *</label>
                                <select class="form-select" id="company-location" required>
                                    <option value="">Select Location</option>
                                    <option value="Remote">Remote</option>
                                    <option value="United States">United States</option>
                                    <option value="Europe">Europe</option>
                                    <option value="Asia">Asia</option>
                                    <option value="Australia">Australia</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="company-logo" class="form-label">Company Logo (optional)</label>
                            <input type="file" class="form-control" id="company-logo" accept="image/*">
                            <small class="form-text text-muted">Max size: 2MB. Supported formats: JPG, PNG, GIF.</small>
                            <img id="logo-preview" class="preview-image" alt="Logo preview">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-company-btn">
                        <span id="save-text">Save Company</span>
                        <span id="save-loading" style="display: none;">
                            <span class="loader"></span>Saving...
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete the company <strong id="delete-company-name"></strong>?</p>
                    <p class="text-danger">This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete-btn">
                        <span id="delete-text">Delete Company</span>
                        <span id="delete-loading" style="display: none;">
                            <span class="loader"></span>Deleting...
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification"></div>
    
    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Global variables
        let companiesData = [];
        let currentPage = 1;
        let hasMoreCompanies = false;
        let currentCompanyId = null;
        let jwtToken = null; // Will store the authentication token
        const correctPassword = 'FSaX54SB'; // Admin password
        
        // DOM Elements
        const authContainer = document.getElementById('auth-container');
        const adminContainer = document.getElementById('admin-container');
        const logoutBtn = document.getElementById('logout-btn');
        const loginBtn = document.getElementById('login-btn');
        const passwordInput = document.getElementById('password');
        const authError = document.getElementById('auth-error');
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');
        const browseBtn = document.getElementById('browse-btn');
        const filePreview = document.getElementById('file-preview');
        const fileName = document.getElementById('file-name');
        const fileInfo = document.getElementById('file-info');
        const cancelUpload = document.getElementById('cancel-upload');
        const importBtn = document.getElementById('import-btn');
        const importText = document.getElementById('import-text');
        const importLoading = document.getElementById('import-loading');
        const tableLoading = document.getElementById('table-loading');
        const tableContainer = document.getElementById('table-container');
        const noData = document.getElementById('no-data');
        const companyTbody = document.getElementById('company-tbody');
        const paginationInfo = document.getElementById('pagination-info');
        const loadMoreBtn = document.getElementById('load-more-btn');
        const searchInput = document.getElementById('search-input');
        const companyForm = document.getElementById('company-form');
        const companyIdInput = document.getElementById('company-id');
        const companyNameInput = document.getElementById('company-name');
        const companyUrlInput = document.getElementById('company-url');
        const companyDescriptionInput = document.getElementById('company-description');
        const companyIndustryInput = document.getElementById('company-industry');
        const companyLocationInput = document.getElementById('company-location');
        const companyLogoInput = document.getElementById('company-logo');
        const logoPreview = document.getElementById('logo-preview');
        const saveCompanyBtn = document.getElementById('save-company-btn');
        const saveText = document.getElementById('save-text');
        const saveLoading = document.getElementById('save-loading');
        const deleteCompanyName = document.getElementById('delete-company-name');
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
        const deleteText = document.getElementById('delete-text');
        const deleteLoading = document.getElementById('delete-loading');
        const addCompanyBtn = document.getElementById('add-company-btn');
        const companyModalLabel = document.getElementById('companyModalLabel');
        const downloadTemplateBtn = document.getElementById('download-template');
        
        // Bootstrap Modal instances
        let companyModal = null;
        let deleteModal = null;
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Bootstrap modals
            companyModal = new bootstrap.Modal(document.getElementById('companyModal'));
            deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
            
            // Set up event listeners
            setupEventListeners();
            
            // Check for existing session (if stored in localStorage)
            checkAuthentication();
        });
        
        // Set up all event listeners
        function setupEventListeners() {
            // Authentication
            loginBtn.addEventListener('click', handleLogin);
            passwordInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });
            logoutBtn.addEventListener('click', handleLogout);
            
            // File upload
            dropArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                dropArea.classList.add('dragover');
            });
            
            dropArea.addEventListener('dragleave', function() {
                dropArea.classList.remove('dragover');
            });
            
            dropArea.addEventListener('drop', function(e) {
                e.preventDefault();
                dropArea.classList.remove('dragover');
                if (e.dataTransfer.files.length) {
                    handleFileSelect(e.dataTransfer.files[0]);
                }
            });
            
            browseBtn.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function() {
                if (fileInput.files.length) {
                    handleFileSelect(fileInput.files[0]);
                }
            });
            
            cancelUpload.addEventListener('click', function() {
                fileInput.value = '';
                filePreview.style.display = 'none';
            });
            
            importBtn.addEventListener('click', importCompanies);
            
            // Search functionality
            searchInput.addEventListener('input', function() {
                const query = searchInput.value.trim().toLowerCase();
                filterCompanies(query);
            });
            
            // Load more companies
            loadMoreBtn.addEventListener('click', loadMoreCompanies);
            
            // Company form
            companyLogoInput.addEventListener('change', function() {
                if (companyLogoInput.files.length) {
                    const file = companyLogoInput.files[0];
                    previewImage(file, logoPreview);
                } else {
                    logoPreview.style.display = 'none';
                }
            });
            
            saveCompanyBtn.addEventListener('click', saveCompany);
            
            // Delete confirmation
            confirmDeleteBtn.addEventListener('click', deleteCompany);
            
            // Reset form when modal is closed
            document.getElementById('companyModal').addEventListener('hidden.bs.modal', function() {
                companyForm.reset();
                logoPreview.style.display = 'none';
                companyIdInput.value = '';
                companyModalLabel.textContent = 'Add Company';
                saveText.textContent = 'Save Company';
            });
            
            // Add company button
            addCompanyBtn.addEventListener('click', function() {
                companyForm.reset();
                logoPreview.style.display = 'none';
                companyIdInput.value = '';
                companyModalLabel.textContent = 'Add Company';
                saveText.textContent = 'Save Company';
            });
            
            // Download template
            downloadTemplateBtn.addEventListener('click', function(e) {
                e.preventDefault();
                downloadExcelTemplate();
            });
        }
        
        // Authentication Functions
        function handleLogin() {
            const password = passwordInput.value;
            
            if (password === correctPassword) {
                // In a real app, this would make an API call to validate the password
                // Since this is client-side only for this demo, we'll simulate a successful login
                authSuccess();
            } else {
                authError.textContent = 'Invalid password. Please try again.';
                authError.style.display = 'block';
            }
        }
        
        function authSuccess() {
            // Hide auth container and show admin container
            authContainer.style.display = 'none';
            adminContainer.style.display = 'block';
            logoutBtn.style.display = 'block';
            
            // Store authentication in localStorage (in real app, this would be a JWT)
            localStorage.setItem('careerAdmin', 'authenticated');
            
            // Fetch the companies data
            fetchCompanies();
        }
        
        function handleLogout() {
            // Clear authentication
            localStorage.removeItem('careerAdmin');
            
            // Show auth container and hide admin container
            authContainer.style.display = 'block';
            adminContainer.style.display = 'none';
            logoutBtn.style.display = 'none';
            
            // Clear password input and error
            passwordInput.value = '';
            authError.style.display = 'none';
        }
        
        function checkAuthentication() {
            // Check if user is already authenticated
            const isAuthenticated = localStorage.getItem('careerAdmin') === 'authenticated';
            
            if (isAuthenticated) {
                authSuccess();
            }
        }
        
        // Company Data Functions
        async function fetchCompanies(page = 1, limit = 20) {
            // Show loading state
            tableLoading.style.display = 'block';
            tableContainer.style.display = 'none';
            noData.style.display = 'none';
            
            try {
                // In a real app, this would make an API call with authentication
                const response = await fetch(`/api/career/companies?page=${page}&limit=${limit}`);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch companies');
                }
                
                const data = await response.json();
                
                // Update state
                if (page === 1) {
                    companiesData = data.companies || [];
                } else {
                    companiesData = [...companiesData, ...(data.companies || [])];
                }
                
                hasMoreCompanies = data.hasMore || false;
                currentPage = page;
                
                // Update UI
                updateCompaniesTable();
                
                // Show appropriate container
                tableLoading.style.display = 'none';
                
                if (companiesData.length === 0) {
                    tableContainer.style.display = 'none';
                    noData.style.display = 'block';
                } else {
                    tableContainer.style.display = 'block';
                    noData.style.display = 'none';
                }
                
                // Update pagination
                paginationInfo.textContent = `Showing ${companiesData.length} companies`;
                loadMoreBtn.disabled = !hasMoreCompanies;
                
            } catch (error) {
                console.error('Error fetching companies:', error);
                showNotification('Failed to load companies. Please try again.', 'error');
                
                tableLoading.style.display = 'none';
                noData.style.display = 'block';
            }
        }
        
        function updateCompaniesTable() {
            // Clear existing rows
            companyTbody.innerHTML = '';
            
            // Add company rows
            companiesData.forEach(company => {
                const row = document.createElement('tr');
                
                // Format date
                const createdDate = new Date(company.created_at);
                const formattedDate = createdDate.toLocaleDateString();
                
                row.innerHTML = `
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="me-2" style="width: 32px; height: 32px; overflow: hidden; border-radius: 4px;">
                                ${company.logo_url ? 
                                    `<img src="${company.logo_url}" alt="${company.name}" style="width: 100%; height: 100%; object-fit: cover;">` : 
                                    `<div class="bg-secondary text-white d-flex align-items-center justify-content-center" style="width: 100%; height: 100%;">${company.name.charAt(0)}</div>`
                                }
                            </div>
                            <div>${company.name}</div>
                        </div>
                    </td>
                    <td><span class="badge bg-light text-dark">${company.industry || 'N/A'}</span></td>
                    <td>${company.location || 'N/A'}</td>
                    <td>
                        <a href="${company.career_page_url}" target="_blank" class="text-truncate d-inline-block" style="max-width: 200px;">
                            ${company.career_page_url}
                        </a>
                    </td>
                    <td>${formattedDate}</td>
                    <td>
                        <div class="d-flex gap-1">
                            <button class="btn btn-sm btn-outline-primary edit-company" data-id="${company.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16">
                                    <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                                </svg>
                            </button>
                            <button class="btn btn-sm btn-outline-danger delete-company" data-id="${company.id}" data-name="${company.name}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                </svg>
                            </button>
                        </div>
                    </td>
                `;
                
                companyTbody.appendChild(row);
            });
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.edit-company').forEach(button => {
                button.addEventListener('click', () => editCompany(button.dataset.id));
            });
            
            document.querySelectorAll('.delete-company').forEach(button => {
                button.addEventListener('click', () => {
                    currentCompanyId = button.dataset.id;
                    deleteCompanyName.textContent = button.dataset.name;
                    deleteModal.show();
                });
            });
        }
        
        function filterCompanies(query) {
            if (!query) {
                // If search is empty, show all companies
                updateCompaniesTable();
                return;
            }
            
            // Filter companies by name, industry, or location
            const filteredCompanies = companiesData.filter(company => {
                return company.name.toLowerCase().includes(query) ||
                    (company.industry && company.industry.toLowerCase().includes(query)) ||
                    (company.location && company.location.toLowerCase().includes(query)) ||
                    (company.description && company.description.toLowerCase().includes(query));
            });
            
            // Temporarily update the table with filtered results
            const originalCompanies = companiesData;
            companiesData = filteredCompanies;
            updateCompaniesTable();
            companiesData = originalCompanies;
            
            // Update pagination info
            paginationInfo.textContent = `Showing ${filteredCompanies.length} of ${companiesData.length} companies`;
        }
        
        async function loadMoreCompanies() {
            if (!hasMoreCompanies) return;
            
            // Disable button during loading
            loadMoreBtn.disabled = true;
            loadMoreBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Loading...';
            
            // Load next page
            await fetchCompanies(currentPage + 1);
            
            // Restore button state
            loadMoreBtn.innerHTML = 'Load More';
            loadMoreBtn.disabled = !hasMoreCompanies;
        }
        
        // File Upload and Import Functions
        function handleFileSelect(file) {
            if (!file) return;
            
            const extension = file.name.split('.').pop().toLowerCase();
            
            // Check if file is Excel
            if (extension !== 'xlsx' && extension !== 'xls') {
                showNotification('Please select an Excel file (.xlsx or .xls)', 'error');
                return;
            }
            
            // Display file info
            fileName.textContent = file.name;
            fileInfo.textContent = 'Processing file...';
            filePreview.style.display = 'block';
            
            // Read file contents
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Get first sheet
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    
                    // Convert to JSON
                    const companies = XLSX.utils.sheet_to_json(firstSheet);
                    
                    if (companies.length === 0) {
                        fileInfo.textContent = 'No data found in the Excel file';
                        return;
                    }
                    
                    // Validate companies data
                    const validCompanies = companies.filter(company => {
                        return company.Name && company['Career Page URL'];
                    });
                    
                    // Display file info
                    if (validCompanies.length === companies.length) {
                        fileInfo.textContent = `Found ${validCompanies.length} companies`;
                    } else {
                        fileInfo.textContent = `Found ${validCompanies.length} valid companies out of ${companies.length} total`;
                    }
                    
                    // Store the data for import
                    fileInput.dataset.companies = JSON.stringify(validCompanies);
                    
                } catch (error) {
                    console.error('Error processing Excel file:', error);
                    fileInfo.textContent = 'Error processing Excel file';
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        async function importCompanies() {
            // Get companies data from dataset
            const companiesJson = fileInput.dataset.companies;
            if (!companiesJson) {
                showNotification('No valid companies data found', 'error');
                return;
            }
            
            const companies = JSON.parse(companiesJson);
            if (companies.length === 0) {
                showNotification('No valid companies to import', 'error');
                return;
            }
            
            // Show loading state
            importText.style.display = 'none';
            importLoading.style.display = 'inline-block';
            importBtn.disabled = true;
            
            // Format data for API
            const formattedCompanies = companies.map(company => ({
                name: company.Name || company.name,
                career_page_url: company['Career Page URL'] || company.career_page_url,
                description: company.Description || company.description || '',
                industry: company.Industry || company.industry || '',
                location: company.Location || company.location || ''
            }));
            
            try {
                // In a real app, this would make an API call to bulk import
                // Simulating API call with a delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Simulate successful import
                // In a real app, we would do POST requests to the API
                let importedCount = 0;
                
                for (const company of formattedCompanies) {
                    // Simulate individual company addition
                    // This is where you'd make the actual API call in a real app
                    importedCount++;
                }
                
                // Show success notification
                showNotification(`Successfully imported ${importedCount} companies`, 'success');
                
                // Reset file input and preview
                fileInput.value = '';
                filePreview.style.display = 'none';
                
                // Refresh companies list
                fetchCompanies();
                
            } catch (error) {
                console.error('Error importing companies:', error);
                showNotification('Failed to import companies. Please try again.', 'error');
            } finally {
                // Reset loading state
                importText.style.display = 'inline-block';
                importLoading.style.display = 'none';
                importBtn.disabled = false;
            }
        }
        
        // Company CRUD Functions
        async function editCompany(id) {
            // Find company by ID
            const company = companiesData.find(company => company.id === id);
            if (!company) return;
            
            // Populate form
            companyIdInput.value = company.id;
            companyNameInput.value = company.name;
            companyUrlInput.value = company.career_page_url;
            companyDescriptionInput.value = company.description || '';
            companyIndustryInput.value = company.industry || '';
            companyLocationInput.value = company.location || '';
            
            // Show logo preview if exists
            if (company.logo_url) {
                logoPreview.src = company.logo_url;
                logoPreview.style.display = 'block';
            } else {
                logoPreview.style.display = 'none';
            }
            
            // Update modal title and button text
            companyModalLabel.textContent = 'Edit Company';
            saveText.textContent = 'Update Company';
            
            // Show modal
            companyModal.show();
        }
        
        async function saveCompany() {
            // Validate form
            if (!companyForm.checkValidity()) {
                companyForm.reportValidity();
                return;
            }
            
            // Show loading state
            saveText.style.display = 'none';
            saveLoading.style.display = 'inline-block';
            saveCompanyBtn.disabled = true;
            
            // Get form data
            const formData = new FormData();
            formData.append('name', companyNameInput.value);
            formData.append('career_page_url', companyUrlInput.value);
            formData.append('description', companyDescriptionInput.value);
            formData.append('industry', companyIndustryInput.value);
            formData.append('location', companyLocationInput.value);
            
            // Add logo if selected
            if (companyLogoInput.files.length) {
                formData.append('logo', companyLogoInput.files[0]);
            }
            
            const isEdit = companyIdInput.value !== '';
            
            try {
                // In a real app, this would make an API call to create or update
                // Simulating API call with a delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                if (isEdit) {
                    // Update existing company
                    // PUT request to /api/career/companies/:id
                    
                    // Simulate successful update
                    showNotification('Company updated successfully', 'success');
                } else {
                    // Create new company
                    // POST request to /api/career/companies
                    
                    // Simulate successful creation
                    showNotification('Company added successfully', 'success');
                }
                
                // Close modal
                companyModal.hide();
                
                // Refresh companies list
                fetchCompanies();
                
            } catch (error) {
                console.error('Error saving company:', error);
                showNotification(`Failed to ${isEdit ? 'update' : 'add'} company. Please try again.`, 'error');
            } finally {
                // Reset loading state
                saveText.style.display = 'inline-block';
                saveLoading.style.display = 'none';
                saveCompanyBtn.disabled = false;
            }
        }
        
        async function deleteCompany() {
            if (!currentCompanyId) return;
            
            // Show loading state
            deleteText.style.display = 'none';
            deleteLoading.style.display = 'inline-block';
            confirmDeleteBtn.disabled = true;
            
            try {
                // In a real app, this would make an API call to delete
                // Simulating API call with a delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Simulate successful deletion
                showNotification('Company deleted successfully', 'success');
                
                // Close modal
                deleteModal.hide();
                
                // Refresh companies list
                fetchCompanies();
                
            } catch (error) {
                console.error('Error deleting company:', error);
                showNotification('Failed to delete company. Please try again.', 'error');
            } finally {
                // Reset loading state
                deleteText.style.display = 'inline-block';
                deleteLoading.style.display = 'none';
                confirmDeleteBtn.disabled = false;
                currentCompanyId = null;
            }
        }
        
        // Utility Functions
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification';
            notification.classList.add(`notification-${type}`);
            notification.style.display = 'block';
            
            // Hide after 3 seconds
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        function previewImage(file, imgElement) {
            if (!file || !imgElement) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                imgElement.src = e.target.result;
                imgElement.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
        
        function downloadExcelTemplate() {
            // Create a simple Excel template for companies
            const template = [
                {
                    'Name': 'TechCorp Inc.',
                    'Career Page URL': 'https://techcorp.example.com/careers',
                    'Description': 'Leading software development company specializing in cloud solutions and enterprise applications.',
                    'Industry': 'Technology',
                    'Location': 'United States'
                },
                {
                    'Name': 'Finance Solutions',
                    'Career Page URL': 'https://financesolutions.example.com/jobs',
                    'Description': 'Global financial services firm offering wealth management and financial technology solutions.',
                    'Industry': 'Finance',
                    'Location': 'Remote'
                }
            ];
            
            // Convert to worksheet
            const ws = XLSX.utils.json_to_sheet(template);
            
            // Create workbook and add worksheet
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Companies');
            
            // Generate Excel file and trigger download
            XLSX.writeFile(wb, 'company_template.xlsx');
        }
    </script>
</body>
</html>
